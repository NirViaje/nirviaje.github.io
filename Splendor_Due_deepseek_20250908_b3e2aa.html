<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>璀璨宝石 - 双人对战</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #f8c471;
            text-shadow: 0 0 10px rgba(248, 196, 113, 0.5);
        }
        
        .game-status {
            display: flex;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .player {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .player-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .player-name {
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .player.active {
            border: 2px solid #f8c471;
            border-radius: 10px;
            padding: 10px;
        }
        
        .gems {
            display: flex;
            gap: 5px;
        }
        
        .gem {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .game-board {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .cards-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
        }
        
        .section-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #f8c471;
            text-align: center;
        }
        
        .cards-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        
        .card {
            width: 90px;
            height: 120px;
            border-radius: 8px;
            padding: 8px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-cost {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 3px;
        }
        
        .cost-gem {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        .card-points {
            align-self: flex-end;
            font-size: 1.5rem;
            font-weight: bold;
            color: gold;
        }
        
        .card.brown { background: #7d5c3c; }
        .card.white { background: #f0f0f0; color: #333; }
        .card.blue { background: #3498db; }
        .card.green { background: #2ecc71; }
        .card.red { background: #e74c3c; }
        
        .nobles-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
        }
        
        .nobles-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }
        
        .noble {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #ffd700 0%, #daa520 100%);
            color: #333;
            font-weight: bold;
            padding: 10px;
            text-align: center;
        }
        
        .gems-pool {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .gems-title {
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.3rem;
            color: #f8c471;
        }
        
        .available-gems {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .gem-token {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s;
        }
        
        .gem-token:hover {
            transform: scale(1.1);
        }
        
        .actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #f8c471 0%, #e67e22 100%);
            color: #fff;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        
        button:disabled {
            background: #777;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .rules-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.5);
            color: #f8c471;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: #1a1a2e;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            color: #fff;
        }
        
        .close-modal {
            float: right;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .gem-red { background: #e74c3c; }
        .gem-blue { background: #3498db; }
        .gem-green { background: #2ecc71; }
        .gem-white { background: #f0f0f0; color: #333; }
        .gem-brown { background: #7d5c3c; }
        .gem-gold { background: linear-gradient(135deg, #ffd700 0%, #daa520 100%); color: #333; }
        
        @media (max-width: 768px) {
            .game-board {
                grid-template-columns: 1fr;
            }
            
            .card {
                width: 70px;
                height: 100px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>璀璨宝石</h1>
            <p>收集宝石，购买发展卡，吸引贵族，成为最富有的商人！</p>
        </header>
        
        <div class="game-status">
            <div class="player active">
                <div class="player-info">
                    <div class="player-name">玩家</div>
                    <div class="prestige">声望: 0</div>
                    <div class="gems">
                        <div class="gem gem-red">0</div>
                        <div class="gem gem-blue">0</div>
                        <div class="gem gem-green">0</div>
                        <div class="gem gem-white">0</div>
                        <div class="gem gem-brown">0</div>
                        <div class="gem gem-gold">0</div>
                    </div>
                </div>
            </div>
            
            <div class="player">
                <div class="player-info">
                    <div class="player-name">AI对手</div>
                    <div class="prestige">声望: 0</div>
                    <div class="gems">
                        <div class="gem gem-red">0</div>
                        <div class="gem gem-blue">0</div>
                        <div class="gem gem-green">0</div>
                        <div class="gem gem-white">0</div>
                        <div class="gem gem-brown">0</div>
                        <div class="gem gem-gold">0</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="gems-pool">
            <div class="gems-title">宝石池</div>
            <div class="available-gems">
                <div class="gem-token gem-red">5</div>
                <div class="gem-token gem-blue">5</div>
                <div class="gem-token gem-green">5</div>
                <div class="gem-token gem-white">5</div>
                <div class="gem-token gem-brown">5</div>
                <div class="gem-token gem-gold">5</div>
            </div>
        </div>
        
        <div class="game-board">
            <div class="cards-section">
                <div class="section-title">发展卡（第一层）</div>
                <div class="cards-container">
                    <div class="card brown">
                        <div class="card-cost">
                            <div class="cost-gem gem-red">3</div>
                        </div>
                        <div class="card-points">1</div>
                    </div>
                    <div class="card white">
                        <div class="card-cost">
                            <div class="cost-gem gem-blue">2</div>
                            <div class="cost-gem gem-green">2</div>
                        </div>
                        <div class="card-points">0</div>
                    </div>
                    <div class="card blue">
                        <div class="card-cost">
                            <div class="cost-gem gem-red">1</div>
                            <div class="cost-gem gem-blue">1</div>
                            <div class="cost-gem gem-green">1</div>
                            <div class="cost-gem gem-white">1</div>
                        </div>
                        <div class="card-points">0</div>
                    </div>
                    <div class="card green">
                        <div class="card-cost">
                            <div class="cost-gem gem-brown">3</div>
                        </div>
                        <div class="card-points">0</div>
                    </div>
                </div>
            </div>
            
            <div class="nobles-section">
                <div class="section-title">贵族</div>
                <div class="nobles-container">
                    <div class="noble">需要3张蓝色卡和3张绿色卡</div>
                    <div class="noble">需要3张红色卡和3张白色卡</div>
                </div>
            </div>
        </div>
        
        <div class="actions">
            <button id="take-gems">拿取宝石</button>
            <button id="buy-card" disabled>购买卡片</button>
            <button id="reserve-card">保留卡片</button>
            <button id="end-turn" disabled>结束回合</button>
        </div>
    </div>
    
    <div class="rules-btn">?</div>
    
    <div class="modal" id="rules-modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>璀璨宝石游戏规则</h2>
            <p>《璀璨宝石》是一款资源管理和策略游戏，玩家扮演文艺复兴时期的商人，通过收集宝石、购买发展卡和吸引贵族来获得声望点数。</p>
            
            <h3>游戏目标</h3>
            <p>首先获得15个声望点数的玩家获胜。</p>
            
            <h3>游戏流程</h3>
            <p>每回合玩家可以执行以下行动之一：</p>
            <ul>
                <li>拿取宝石 - 可以选择拿取3种不同颜色的宝石各1个，或者拿取2个相同颜色的宝石（前提是该颜色宝石至少有4个）</li>
                <li>购买卡片 - 支付卡片左上角所示的宝石成本，获得该卡片</li>
                <li>保留卡片 - 保留一张卡片到自己的保留区，并拿取1个黄金宝石（万能宝石）</li>
            </ul>
            
            <h3>卡片功能</h3>
            <p>卡片提供：</p>
            <ul>
                <li>永久宝石折扣（购买后续卡片时可当作1个对应颜色的宝石）</li>
                <li>声望点数（右上角的数字）</li>
            </ul>
            
            <h3>贵族板块</h3>
            <p>当玩家满足贵族板块上所示的卡片要求时，会自动吸引该贵族，获得对应的声望点数。</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 游戏状态
            const gameState = {
                currentPlayer: 0, // 0: 玩家, 1: AI
                players: [
                    {
                        gems: [0, 0, 0, 0, 0, 0], // 红,蓝,绿,白,棕,金
                        cards: [],
                        reservedCards: [],
                        prestige: 0
                    },
                    {
                        gems: [0, 0, 0, 0, 0, 0],
                        cards: [],
                        reservedCards: [],
                        prestige: 0
                    }
                ],
                availableGems: [5, 5, 5, 5, 5, 5], // 红,蓝,绿,白,棕,金
                cards: [
                    // 第一层卡片
                    [
                        { cost: [3, 0, 0, 0, 0], color: 4, points: 1 },
                        { cost: [0, 2, 2, 0, 0], color: 3, points: 0 },
                        { cost: [1, 1, 1, 1, 0], color: 1, points: 0 },
                        { cost: [0, 0, 0, 0, 3], color: 2, points: 0 }
                    ],
                    // 第二层卡片（示例）
                    [
                        { cost: [0, 5, 0, 0, 0], color: 4, points: 2 },
                        { cost: [0, 0, 0, 5, 0], color: 3, points: 2 },
                        { cost: [0, 0, 0, 0, 5], color: 1, points: 2 },
                        { cost: [5, 0, 0, 0, 0], color: 2, points: 2 }
                    ]
                ],
                nobles: [
                    { requirement: [0, 0, 3, 3, 0], points: 3 },
                    { requirement: [3, 3, 0, 0, 0], points: 3 }
                ]
            };
            
            // 宝石颜色映射
            const gemColors = ['red', 'blue', 'green', 'white', 'brown', 'gold'];
            
            // DOM元素
            const playerGems = document.querySelectorAll('.player:first-child .gems .gem');
            const aiGems = document.querySelectorAll('.player:last-child .gems .gem');
            const availableGems = document.querySelectorAll('.gem-token');
            const takeGemsBtn = document.getElementById('take-gems');
            const buyCardBtn = document.getElementById('buy-card');
            const reserveCardBtn = document.getElementById('reserve-card');
            const endTurnBtn = document.getElementById('end-turn');
            const rulesBtn = document.querySelector('.rules-btn');
            const rulesModal = document.getElementById('rules-modal');
            const closeModal = document.querySelector('.close-modal');
            
            // 初始化游戏
            function initGame() {
                updateUI();
            }
            
            // 更新UI
            function updateUI() {
                // 更新玩家宝石
                for (let i = 0; i < 6; i++) {
                    playerGems[i].textContent = gameState.players[0].gems[i];
                    aiGems[i].textContent = gameState.players[1].gems[i];
                }
                
                // 更新可用宝石
                for (let i = 0; i < 6; i++) {
                    availableGems[i].textContent = gameState.availableGems[i];
                }
                
                // 更新声望
                document.querySelector('.player:first-child .prestige').textContent = 
                    `声望: ${gameState.players[0].prestige}`;
                document.querySelector('.player:last-child .prestige').textContent = 
                    `声望: ${gameState.players[1].prestige}`;
                
                // 更新当前玩家高亮
                const playerElements = document.querySelectorAll('.player');
                playerElements.forEach((el, index) => {
                    if (index === gameState.currentPlayer) {
                        el.classList.add('active');
                    } else {
                        el.classList.remove('active');
                    }
                });
            }
            
            // 拿取宝石
            takeGemsBtn.addEventListener('click', function() {
                alert('请选择要拿取的宝石（最多3种不同颜色或2个相同颜色）');
                // 这里应该有更复杂的逻辑来处理宝石选择
                // 简化版：随机拿取宝石
                if (gameState.currentPlayer === 0) {
                    const gemsToTake = [];
                    // 简单逻辑：随机选择1-3种宝石
                    const count = Math.floor(Math.random() * 3) + 1;
                    for (let i = 0; i < count; i++) {
                        const gemType = Math.floor(Math.random() * 5); // 不包括黄金
                        if (gameState.availableGems[gemType] > 0) {
                            gemsToTake.push(gemType);
                        }
                    }
                    
                    // 更新游戏状态
                    gemsToTake.forEach(gem => {
                        gameState.players[0].gems[gem]++;
                        gameState.availableGems[gem]--;
                    });
                    
                    updateUI();
                    endTurnBtn.disabled = false;
                    takeGemsBtn.disabled = true;
                }
            });
            
            // 购买卡片
            buyCardBtn.addEventListener('click', function() {
                alert('请选择要购买的卡片');
                // 简化版：随机购买一张卡片
                if (gameState.currentPlayer === 0) {
                    // 假设购买第一张卡片
                    const card = gameState.cards[0][0];
                    
                    // 检查玩家是否有足够的宝石
                    let canAfford = true;
                    for (let i = 0; i < 5; i++) {
                        if (gameState.players[0].gems[i] < card.cost[i]) {
                            canAfford = false;
                            break;
                        }
                    }
                    
                    if (canAfford) {
                        // 支付成本
                        for (let i = 0; i < 5; i++) {
                            gameState.players[0].gems[i] -= card.cost[i];
                            gameState.availableGems[i] += card.cost[i];
                        }
                        
                        // 获得卡片
                        gameState.players[0].cards.push(card);
                        gameState.players[0].prestige += card.points;
                        
                        // 移除已购买的卡片
                        gameState.cards[0].splice(0, 1);
                        
                        updateUI();
                        endTurnBtn.disabled = false;
                        buyCardBtn.disabled = true;
                    } else {
                        alert('你没有足够的宝石购买这张卡片！');
                    }
                }
            });
            
            // 保留卡片
            reserveCardBtn.addEventListener('click', function() {
                alert('请选择要保留的卡片');
                // 简化版：随机保留一张卡片
                if (gameState.currentPlayer === 0) {
                    // 检查是否有黄金宝石可用
                    if (gameState.availableGems[5] > 0) {
                        // 保留第一张卡片
                        const card = gameState.cards[0][0];
                        gameState.players[0].reservedCards.push(card);
                        gameState.cards[0].splice(0, 1);
                        
                        // 拿取一个黄金宝石
                        gameState.players[0].gems[5]++;
                        gameState.availableGems[5]--;
                        
                        updateUI();
                        endTurnBtn.disabled = false;
                        reserveCardBtn.disabled = true;
                    } else {
                        alert('没有可用的黄金宝石！');
                    }
                }
            });
            
            // 结束回合
            endTurnBtn.addEventListener('click', function() {
                // 切换到下一个玩家
                gameState.currentPlayer = (gameState.currentPlayer + 1) % 2;
                
                // 重置按钮状态
                takeGemsBtn.disabled = false;
                buyCardBtn.disabled = false;
                reserveCardBtn.disabled = false;
                endTurnBtn.disabled = true;
                
                updateUI();
                
                // 如果是AI的回合
                if (gameState.currentPlayer === 1) {
                    setTimeout(aiTurn, 1000);
                }
            });
            
            // AI回合
            function aiTurn() {
                // 简化版AI：随机选择一个行动
                const actions = ['takeGems', 'buyCard', 'reserveCard'];
                const action = actions[Math.floor(Math.random() * actions.length)];
                
                switch(action) {
                    case 'takeGems':
                        // 拿取宝石
                        const gemsToTake = [];
                        const count = Math.floor(Math.random() * 3) + 1;
                        for (let i = 0; i < count; i++) {
                            const gemType = Math.floor(Math.random() * 5);
                            if (gameState.availableGems[gemType] > 0) {
                                gemsToTake.push(gemType);
                            }
                        }
                        
                        gemsToTake.forEach(gem => {
                            gameState.players[1].gems[gem]++;
                            gameState.availableGems[gem]--;
                        });
                        break;
                        
                    case 'buyCard':
                        // 尝试购买第一张卡片
                        const card = gameState.cards[0][0];
                        let canAfford = true;
                        
                        for (let i = 0; i < 5; i++) {
                            if (gameState.players[1].gems[i] < card.cost[i]) {
                                canAfford = false;
                                break;
                            }
                        }
                        
                        if (canAfford) {
                            for (let i = 0; i < 5; i++) {
                                gameState.players[1].gems[i] -= card.cost[i];
                                gameState.availableGems[i] += card.cost[i];
                            }
                            
                            gameState.players[1].cards.push(card);
                            gameState.players[1].prestige += card.points;
                            gameState.cards[0].splice(0, 1);
                        }
                        break;
                        
                    case 'reserveCard':
                        // 保留卡片
                        if (gameState.availableGems[5] > 0) {
                            const reserveCard = gameState.cards[0][0];
                            gameState.players[1].reservedCards.push(reserveCard);
                            gameState.cards[0].splice(0, 1);
                            
                            gameState.players[1].gems[5]++;
                            gameState.availableGems[5]--;
                        }
                        break;
                }
                
                updateUI();
                
                // 结束AI回合
                setTimeout(function() {
                    gameState.currentPlayer = 0;
                    takeGemsBtn.disabled = false;
                    buyCardBtn.disabled = false;
                    reserveCardBtn.disabled = false;
                    endTurnBtn.disabled = true;
                    updateUI();
                }, 1000);
            }
            
            // 规则弹窗
            rulesBtn.addEventListener('click', function() {
                rulesModal.style.display = 'flex';
            });
            
            closeModal.addEventListener('click', function() {
                rulesModal.style.display = 'none';
            });
            
            rulesModal.addEventListener('click', function(e) {
                if (e.target === rulesModal) {
                    rulesModal.style.display = 'none';
                }
            });
            
            // 初始化游戏
            initGame();
        });
    </script>
</body>
</html>